---
title: "Testing ArkScript"
slug: "testing_arkscript"
description: ""
date: 2023-09-07T16:33:54+02:00
lastmod: 2023-09-07T16:33:54+02:00
draft: false
weight: 503
---

## Running the test suites

Build the tests using `-DARK_TESTS=On`.

Run the `unittests` target to:
- run various C++ unit tests,
- run error messages testing,
- run AST & parsing tests,
- run formatting tests,
- run language tests (`tests/unittests/resources/LangSuite/`)

### Adding new tests

The easiest tests to add are snapshot tests, in `tests/unittests/resources/...Suite/`. They expect an input `.ark` file and a desired output file (`.expected` or `.json` depending on the suite).

- **ASTSuite** tests the AST parsing, which is then dumped to JSON by the JsonCompiler
- **BytecodeReaderSuite** tests the decoding of ArkScript bytecode files
- **CompilerSuite** tests the IR generation and optimization
- **DiagnosticsSuite** tests the generation of error messages
  - **compileTime** for errors generated by the compiler
  - **runtime** for errors generated by the virtual machine
- **FormatterSuite** tests the code formatter. Input is badly formatted, output is the expected formatted code
- **LangSuite** are unit tests written in ArkScript itself, testing the builtins and the language
- **NameResolutionSuite** tests the resolution of names and packages with import directives
- **OptimizerSuite** tests the AST optimizer. Nodes should be removed by this pass, we ensure they are not present in the final AST
- **ParserSuite** tests the parser, along with parsing specific errors
  - **failure** for the parsing failures
  - **success** for the successful parsing, output is the pretty printed AST

### Coverage reports

It is **recommended** to add `-DARK_COVERAGE=On` to generate coverage reports, this way you can check if your feature has sufficient test coverage instead of waiting on the CI.

Generate coverage reports with `cmake --build build --target coverage`, it will generate HTML files under `build/coverage/` (main file is `index.html`).

